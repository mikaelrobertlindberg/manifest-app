format_version: '13'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

project_type: react-native

workflows:
  ios-testflight:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8: {}
    - restore-npm-cache@1:
        inputs:
        - cache_restore_enabled: 'yes'
    - npm@1:
        inputs:
        - workdir: "$BITRISE_SOURCE_DIR/ManifestApp"
        - command: install
    - install-missing-android-tools@3:
        inputs:
        - gradlew_path: "$BITRISE_SOURCE_DIR/ManifestApp/android/gradlew"
    - expo-detach@2:
        inputs:
        - workdir: "$BITRISE_SOURCE_DIR/ManifestApp"
        - expo_cli_version: latest
    - certificate-and-profile-installer@1: {}
    - xcode-archive@5:
        inputs:
        - project_path: "$BITRISE_SOURCE_DIR/ManifestApp/ios/ManifestApp.xcworkspace"
        - scheme: ManifestApp
        - export_method: app-store
    - deploy-to-itunesconnect-application-loader@1:
        inputs:
        - password: "$APPLE_APP_SPECIFIC_PASSWORD"
        - app_password: "$APPLE_APP_SPECIFIC_PASSWORD"
    - deploy-to-bitrise-io@2: {}